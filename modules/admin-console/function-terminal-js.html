<script>
	$("#navigation").html("终端管理");
	
	var template = "<tr><td>#{host}</td><td>#{path}</td><td>#{sid}</td><td><button id=\"config_#{sid}\" data-toggle=\"dropdown\" class=\"btn btn-primary btn-xs fa fa-cog\"></button></td><td><button id=\"status_#{sid}\" data-toggle=\"dropdown\" class=\"btn btn-primary btn-xs fa fa-desktop\"></button></td><td><button id=\"dependency_#{sid}\" data-toggle=\"dropdown\" class=\"btn btn-primary btn-xs fa fa-sitemap\"></button></td></td><td><button id=\"chart_#{sid}\" data-toggle=\"dropdown\" class=\"btn btn-primary btn-xs fa fa-line-chart\"></button></td></tr>";
	
	//Select for Groups
	function groups() {
		jQuery.ajax({
			type : "GET",
			url : "/api/terminal/groups",
			success : function callback(data) {
				$("#finder_groups").empty(); 
				$("#finder_groups").prepend("<option value=''>Select Group ... </option>");
				$(data).each(function(index, element){
					$("#finder_groups").append("<option value='" + element + "'>" + element + "</option>"); 
				});
			}
		});
	}

	function loadings(data, element) {
		$("#service-tab_tbody").empty();
		$(data).each(function(index, each){
			//加载服务项
			$("#service-tab_tbody").append(template.replace("#{host}", each.host).replaceAll("#{path}", each.path).replaceAll("#{sid}", each.sid));
			//绑定图表,依赖按钮等
			$("#chart_" + each.sid).click(function() {
				window.open("/?function=function-chart-status&sid=" + each.sid, "_blank");
			});
			$("#dependency_" + each.sid).click(function() {
				window.open("/?function=function-dependency-imported&sid=" + each.sid, "_blank");
			});
			$("#status_" + each.sid).click(function() {
				window.open("/?function=function-status&sid=" + each.sid + "&host=" + each.host, "_blank");
			});
			$("#config_" + each.sid).click(function() {
				window.open("/?function=function-config&sid=" + each.sid + "&host=" + each.host, "_blank");
			});
		});
	}
	
	function loading(data, element) {
		$("#service-tab_tbody").empty();
		//加载服务项
		$("#service-tab_tbody").append(template.replace("#{host}", data.host).replaceAll("#{path}", data.path).replaceAll("#{sid}", data.sid));
		//绑定图表,依赖按钮等
		$("#chart_" + data.sid).click(function() {
			window.open("/?function=function-chart-status&sid=" + data.sid, "_blank");
		});
		$("#dependency_" + data.sid).click(function() {
			window.open("/?function=function-dependency-imported&sid=" + data.sid, "_blank");
		});
		$("#status_" + data.sid).click(function() {
			window.open("/?function=function-status&sid=" + data.sid + "&host=" + data.host, "_blank");
		});
		$("#config_" + data.sid).click(function() {
			window.open("/?function=function-config&sid=" + data.sid + "&host=" + data.host, "_blank");
		});
	}
	
	//Group变化
	$("#finder_groups").change(function() {
		$("#finder_sid").val("");
		$("#finder_sid").attr("placeholder", "SID");
		jQuery.ajax({
			type : "GET",
			url : "/api/terminal/group?group=" + $("#finder_groups").val(),
			success : loadings
		});
	});
	
	//SID变化
	$("#finder_sid").change(function() {
		if($("#finder_sid").val() != ""){
			groups();
			jQuery.ajax({
				type : "GET",
				url : "/api/terminal/sid?sid=" + $("#finder_sid").val(),
				success : loading
			});
		}
	});
	
	$(document).ready(function() {
		groups();
	});
</script>